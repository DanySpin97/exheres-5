# Copyright 2014 Alexander Scheuermann <alex+exherbo@tnix.de>
# Distributed under the terms of the GNU General Public License v2

require \
    github [ user=brunoos tag=${PNV} ] \
    lua [ multiunpack=true whitelist="5.1 5.2" work=${PN}-${PNV} ] \
    flag-o-matic

SUMMARY="OpenSSL library binding to provide TLS/SSL communication"
HOMEPAGE="https://github.com/brunoos/luasec"

LICENCES="MIT"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build+run:
        dev-libs/openssl
        dev-lua/luasocket[lua_abis:*(-)?]
"

DEFAULT_SRC_COMPILE_PARAMS=(
    linux
    )

prepare_one_multibuild() {
    append-flags -I /usr/include/lua$(lua_get_abi)

    edo sed -i \
        -e "s;/lib;/${LIBDIR};"\
        Makefile

    edo cd src
    edo lua options.lua -g /usr/include/openssl/ssl.h > options.h
}

compile_one_multibuild() {
    LDFLAGS="$(raw-ldflags)"
    emake "${DEFAULT_SRC_COMPILE_PARAMS[@]}"
}

