# Copyright 2014 Alexander Scheuermann <alex+exherbo@tnix.de>
# Distributed under the terms of the GNU General Public License v2

require lua [ multibuild=false whitelist="5.1 5.2 5.3" ]

SUMMARY="designed to offer a flexible but easy to use syntax highlighter for several output formats"
DESCRIPTION="
Highlight converts sourcecode to HTML, XHTML, RTF, LaTeX, TeX, SVG, BBCode and terminal escape sequences with coloured syntax highlighting. Language definitions and colour themes are customizable.
"
HOMEPAGE="http://www.andre-simon.de/doku/${PN}/en/${PN}.php"
DOWNLOADS="http://www.andre-simon.de/zip/${PNV}.tar.bz2"

LICENCES="GPL-3"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="doc qt4"

DEPENDENCIES="
    build+run:
        dev-libs/boost
        dev-util/pkg-config
        doc? ( app-doc/doxygen )
        qt4? ( x11-libs/qt:4 )
"

src_prepare() {
    default

    edo sed \
        -e '/^CXX=/d' \
        -e '/^AR=/d' \
        -e 's/CFLAGS:=-Wall -O2 ${CFLAGS} -DNDEBUG/CFLAGS:=-Wall ${CFLAGS}/' \
        -e 's/^LDFLAGS =/LDFLAGS +=/' \
        -e 's/pkg-config/${PKG_CONFIG}/' \
        -i src/makefile

    edo sed \
        -e "s/LIBS += -llua/LIBS += -llua$(lua_get_abi)/" \
        -i src/gui-qt/highlight.pro
}

DEFAULT_SRC_INSTALL_PARAMS=(
    bin_dir=/usr/$(exhost --target)/bin
    )

src_compile() {
    emake help
    emake cli
    if optionq qt4; then
        emake gui
    fi
}

src_install() {
    default

    if optionq qt4; then
        emake -j1 DESTDIR="${IMAGE}" ${DEFAULT_SRC_INSTALL_PARAMS[@]} install-gui
    fi
    if optionq doc; then
        emake -j1 DESTDIR="${IMAGE}" ${DEFAULT_SRC_INSTALL_PARAMS[@]} apidocs
    fi
}

